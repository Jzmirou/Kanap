(()=>{var N=Object.defineProperty;var P=(n,t,e)=>t in n?N(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var E=(n,t,e)=>(P(n,typeof t!="symbol"?t+"":t,e),e);var h=class{cart;constructor(){if(localStorage.getItem("cart")){let t=JSON.parse(localStorage.getItem("cart"));this.cart=t}else this.cart=[]}addCart=(t,e,r=1)=>{let a=Number(r);if(a<=0)throw new Error("on ne peux pas ajout\xE9 0 ou moins en quantit\xE9");let i=this.cart.find(o=>o.id===t&&o.color===e);if(i){let o=i.quantity+a;this.checkMaxProduct(t,e,r),i.quantity=o}else this.cart.push({id:t,quantity:a,color:e});this.save(),console.log("Produit ajout\xE9")};removeCart=(t,e,r)=>{let a=this.findProduct(t,e);if(!a)throw new Error("Le produit n'est pas le panier, il ne peux pas \xEAtre supprim\xE9");let i=Number(a.quantity),o=Number(r)||i;if(i===o){let l=this.cart.findIndex(s=>s.id===t&&s.color===e);this.cart.splice(l,1)}else a.quantity-=o;this.save(),console.log("Produit supprim\xE9")};save=()=>{let t=JSON.stringify(this.cart);localStorage.setItem("cart",t)};findProduct=(t,e)=>this.cart.find(r=>r.id===t&&r.color===e);getCartProductIds=()=>{let t=new Set;for(let e of this.cart)t.add(e.id);return[...t]};isCartEmpty=()=>!this.cart||this.cart.length===0;checkMaxProduct=(t,e,r)=>{let a=this.findProduct(t,e);if(!a)return;let i=100,o=Number(a.quantity)+r,l=i-Number(a.quantity);if(Number(a.quantity)>=i)throw new Error("La quantit\xE9 maximal pour ce produit est atteint");if(o>i)throw new Error(`Quantit\xE9 maximal atteint, quantit\xE9 restante: ${Math.abs(i-a.quantity)}`)}};var A="http://localhost:3000/api",b=async(n,t={})=>{let e=await fetch(`${A}${n}`,{...t,headers:{Accept:"application/json",...t.headers}});if(!e.ok)throw new Error(`Pas de r\xE9ponse du serveur ! status: ${e.status}`,{cause:e});return await e.json()};var $=async n=>await b(`/products/${n}`,{method:"GET"}),q=async n=>{let t=[];for(let r of n)t.push($(r));return await Promise.all(t)},I=async(n,t)=>{let e=JSON.stringify({contact:n,products:t});return await b("/products/order",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:e})};var c=(n,t={})=>{let e=document.createElement(n);for(let[r,a]of Object.entries(t))e.setAttribute(r,a);return e};var f=class{#t;constructor(){let t=c("p");t.style.fontSize="1.5rem",t.style.fontWeight="bold",t.innerText="LOADING ...",this.#t=t}get element(){return this.#t}};var S=n=>!n||n==="",T=n=>/^[a-zA-Z0-9.!#$%&â€™*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(n),Q=n=>/^[a-zA-Z0-9]*$/.test(n);var y=class{inputs;Cart;constructor(t){let e=document.querySelector("#firstName"),r=document.querySelector("#lastName"),a=document.querySelector("#address"),i=document.querySelector("#city"),o=document.querySelector("#email"),l=document.querySelector("#order");this.inputs={firstName:e,lastName:r,address:a,city:i,email:o},this.Cart=t,l.addEventListener("click",this.handleSubmit);for(let[s,u]of Object.entries(this.inputs))u.addEventListener("input",d=>{this.validation(u)})}validation=t=>{let e=document.querySelector(`#${t.id}ErrorMsg`),r;try{if(S(t.value))throw new Error("Champ non renseign\xE9");switch(t.id){case this.inputs.email.id:if(!T(t.value))throw new Error("Email entr\xE9 non valide");break;default:if(!Q(t.value))throw new Error("Caract\xE8res sp\xE9ciaux non accept\xE9")}return t.style.border="none",e.textContent="",[r=!0,void 0]}catch(a){return console.warn(a),t.style.border="2px solid red",e.textContent=a.message,[r=!1,a]}};checkAllInput=()=>{let t={},e=[];for(let[a,i]of Object.entries(this.inputs)){let[o,l]=this.validation(i);o?t={...t,[a]:i.value}:e.push(l)}return[e.length===0,t]};handleSubmit=t=>{t.preventDefault();let[e,r]=this.checkAllInput();if(!e)return;let a=this.Cart.cart.map(i=>i.id);I(r,a).then(i=>{localStorage.clear(),document.location.href=`confirmation.html?id=${i.orderId}`}).catch(i=>console.error(i))}};var g=class{element;dataItem;itemQuantity;Cart;displayIfCartEmpty;updateTotal;constructor(t,e,r,a){let i=c("article",{class:"cart__item"}),o=c("div",{class:"cart__item__img"}),l=c("img",{src:`${t.imgUrl}`,alt:`${t.altTxt}`}),s=c("div",{class:"cart__item__content"}),u=c("div",{class:"cart__item__content__description"}),d=c("h2");d.innerText=t.name;let m=c("p");m.innerText=t.color;let x=c("p");x.innerText=t.price+" \u20AC";let w=new _(t,e,this.deleteItem,a);i.append(o),i.append(s),o.append(l),s.append(u),s.append(w.element),u.append(d),u.append(m),u.append(x),this.element=i,this.itemQuantity=w.itemQuantity,this.dataItem=t,this.Cart=e,this.displayIfCartEmpty=r,this.updateTotal=a}deleteItem=()=>{this.Cart.removeCart(this.dataItem.id,this.dataItem.color,Number(this.itemQuantity.value)),this.updateTotal(),this.displayIfCartEmpty(),this.element.remove()}},_=class{element;dataItem;Cart;itemQuantity;updateTotal;deleteItem;constructor(t,e,r,a){let i=c("div",{class:"cart__item__content__settings"}),o=c("div",{class:"cart__item__content__settings__quantity"}),l=c("p");l.innerText="Qt\xE9 : ";let s=c("input",{type:"number",class:"itemQuantity",name:"itemQuantity",min:"1",max:"100",value:t.quantity}),u=c("div",{class:"cart__item__content__settings__delete"}),d=c("p",{class:"deleteItem"});d.innerText="Supprimer",i.append(o),i.append(u),o.append(l),o.append(s),u.append(d),this.element=i,this.dataItem=t,this.Cart=e,this.itemQuantity=s,this.updateTotal=a,this.deleteItem=r,d.addEventListener("click",this.deleteItem),s.addEventListener("change",this.handleChangeQuantity)}handleChangeQuantity=t=>{let e=Number(t.target.value),r=Number(t.target.defaultValue);if(e<0&&(t.target.value=0,e=0),e===0){this.deleteItem();return}e>100&&(t.target.value=100,e=100),e>r?(console.log("add one",`before:${r} after:${e} `),this.Cart.addCart(this.dataItem.id,this.dataItem.color,e-r)):e<r&&(console.log("del one",`before:${r} after:${e} `),this.Cart.removeCart(this.dataItem.id,this.dataItem.color,r-e)),t.target.defaultValue=e,this.updateTotal()}};var C=class{element;Cart;productsData;totalPrice;totalQuantity;constructor(t,e){let r=document.querySelector(".cart__price"),a=document.querySelector("#totalQuantity"),i=document.querySelector("#totalPrice");this.element=r,this.Cart=e,this.productsData=t,this.totalPrice=i,this.totalQuantity=a,this.updateTotal()}updateTotal=()=>{this.totalPrice.textContent=this.getTotalPrice(),this.totalQuantity.textContent=this.getTotalArticle()};getTotalPrice=()=>{if(this.Cart.isCartEmpty())return;let t=this.Cart.cart.map(r=>{let a=this.productsData.find(i=>i._id===r.id);return{id:r.id,color:r.color,quantity:Number(r.quantity),price:Number(a.price)}}),e=0;for(let r of t)e+=r.price*r.quantity;return e};getTotalArticle=()=>{if(this.Cart.isCartEmpty())return;let t=0;for(let e of this.Cart.cart)t+=e.quantity;return t}};var v=class{element;Cart;constructor(t,e){let r=new C(t,e),a=new y(e),i=document.querySelector("#cart"),o=document.querySelector("#cart__items");for(let l of e.cart){let s=t.find(m=>m._id===l.id);if(!s)throw new Error("Les information du panier sont invalide");let u={id:l.id,imgUrl:s.imageUrl,imgAltText:s.altTxt,name:s.name,color:l.color,price:s.price,quantity:l.quantity},d=new g(u,e,this.displayIfCartEmpty,r.updateTotal);o.append(d.element)}this.element=i,this.Cart=e,this.displayIfCartEmpty()}displayIfCartEmpty=()=>{this.Cart.isCartEmpty()&&(this.element.innerHTML=`
        <p style="text-align: center;font-size: 1.25rem">Aucun produit dans le panier</p>
        `)}},p=v;E(p,"initialize",async(t,e)=>{try{let r=new f().element;t.append(r);let a=await q(e.getCartProductIds());return r.remove(),new v(a,e)}catch(r){console.warn(r)}});var k=document.querySelector("#cart"),O=async()=>{try{await p.initialize(k,new h)}catch(n){console.error(n)}};O();})();
//# sourceMappingURL=cart.js.map
